
# BFChan

![](https://img.shields.io/badge/License-GPLv3-green)
![](https://img.shields.io/badge/OS-Windows-blue)
![](https://img.shields.io/badge/CPU-x86%20and%20x64-blue)
![](https://img.shields.io/badge/Compiler-GCC-blue)

\| 日本語 \| [English](README.md) \| 

BFChan はC言語で書かれた [BrainFuck](https://ja.wikipedia.org/wiki/Brainfuck) のコンパイラです。

x86/x64 の Windows 専用です。
初歩的な機能ですが、ちゃんと最適化もしてくれます。

本当は名前を BFC にする予定でしたがもう既にあるようなので、BFChan に改名しました。
BFChanは「Brain Fuck コンパイラちゃん」の略称です。
良い名前が思いつかなかったよ……。悲しみ。

## Usage

BFChan で BrainFuck をコンパイルしたい場合には bfchan コマンドを利用してください。
bfchan コマンドはファイルまたは標準入力から BrainFuck のコードを読み込み、コンパイルし、オブジェクトファイルを作成します。
BFChan は実行ファイルを作成する機能を持っていません。
そのため、実行ファイルを作成したい場合、コンパイル後に作成されたオブジェクトファイルを GCC でリンクしてください。

下記の例では文字列 "Hello world!" を出力し改行するプログラム helloworld.exe を作成しています。

```shell
$ bfchan -o hellowold.o <<EOF
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
+
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
+++++++++++
>
++++++++++++++++++++
++++++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
+++++++++++++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
+++++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++
>
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
++++++++++++++++++++
>
++++++++++++++++++++
+++++++++++++
>
++++++++++
<<<<<<<<<<<<
[.>]
EOF
$ gcc helloworld.o -o helloworld.exe
```

### Compile as C Function

BFChan は単一のアプリケーションとしてだけでなく、BrainFuck のソースコードをC言語の関数としてコンパイルすることもできます。
C言語の関数としてコンパイルされた場合、プログラムは char 型の配列を受け取る関数としてコンパイルされ、与えられた配列の上で動作します。

実際にコードを書き、関数としてコンパイルし、C言語で使用してみましょう。
下記のコードは与えられた配列を 0 の値を読み込むまで読み進めながら画面に出力するプログラムです。
このコードを書き終えたら print.b として保存しましょう。

```brainfuck
[.>]
```

BrainFuck のソースコードをC言語用の関数としてコンパイルしたい場合には -c オプションを使用します。
-c オプションはソースコードのファイル名を関数名に使用します。
この場合はファイル print.b をコンパイルしているため、関数名は print になります。
早速コンパイルしてみましょう。

```shell
$ bfchan -c print.b -o print.o
```

-c オプションを使用して BrainFuck のソースコードをコンパイルした場合、
BFChan はC言語用に専用のヘッダファイルを自動的に出力先のディレクトリに作成します。
このヘッダファイルをインクルードすることで、C言語側から BFChan でコンパイルされた関数を使用することができます。

```c
extern int _cdecl print (char*);
```

コンパイルされた関数 print をC言語内で使用したい場合には、
さきほど自動生成された print.h をインクルードします。
include文を書き終えたら、下記のようにコンパイルされた関数を配列を引数に呼び出します。
関数は文字を画面に出力する際に問題が発生しなければ常に 0 を返します。
内部でなにかしらの問題が発生した場合には 0 以外の値を返します。

このコードを書き終えたら main.c として保存しましょう。

```c
#include "print.h"

int main (){
  print("Hello world!\n");
  return 0;
}
```

最後にこれらのファイルを GCC で実行ファイルにコンパイル・リンクすれば完了です。

```shell
$ gcc main.c print.o -o helloworld.exe
```

## Requirements 

* [Nanafy](https://github.com/tikubonn/nanafy) 1.0.0

## Installation 

makefile が同梱されているので下記のコマンドからビルドすることができます。
ビルドが成功した場合、bin ディレクトリに nanafy.dll・bfchan.exe の２つのファイルが作成されます。

BFChan はオブジェクトファイルを作成する処理に Nanafy を使用しています。
そのため BFChan をビルドする際には Nanafy の動的リンクライブラリとヘッダファイルが存在するディレクトリを指定する必要があります。
既に Nanafy がビルド済み且つ環境変数のパスに登録済みである場合、これらの変数は必要ありません。

```shell
$ make NANAFY_INCLUDE_DIR="" NANAFY_LIBRARY_DIR=""
```

ビルド後のファイルの移動や環境変数への登録は各自で行ってください。

## License 

BFChan は [GNU General Public License Version3](LICENSE) の許諾の下で公開されています。
